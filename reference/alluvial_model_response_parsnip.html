<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>create model response plot for parsnip models — alluvial_model_response_parsnip • easyalluvial</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="create model response plot for parsnip models — alluvial_model_response_parsnip" />
<meta property="og:description" content="Wraps alluvial_model_response and
 get_data_space into one call for parsnip models." />
<meta property="og:image" content="https://erblast.github.io/easyalluvial/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">easyalluvial</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/data_exploration.html">Data Exploration with Alluvial Plots</a>
    </li>
    <li>
      <a href="../articles/model_response.html">Partial Dependence Alluvial Plots - Visualising Model Response</a>
    </li>
    <li>
      <a href="../articles/parcats.html">Interactive Plots with parcats</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/erblast/easyalluvial/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>create model response plot for parsnip models</h1>
    <small class="dont-index">Source: <a href='https://github.com/erblast/easyalluvial/blob/master/R/alluvial_model_response.R'><code>R/alluvial_model_response.R</code></a></small>
    <div class="hidden name"><code>alluvial_model_response_parsnip.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Wraps <code><a href='alluvial_model_response.html'>alluvial_model_response</a></code> and
 <code><a href='get_data_space.html'>get_data_space</a></code> into one call for parsnip models.</p>
    </div>

    <pre class="usage"><span class='fu'>alluvial_model_response_parsnip</span><span class='op'>(</span>
  <span class='va'>m</span>,
  <span class='va'>data_input</span>,
  degree <span class='op'>=</span> <span class='fl'>4</span>,
  bins <span class='op'>=</span> <span class='fl'>5</span>,
  bin_labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"LL"</span>, <span class='st'>"ML"</span>, <span class='st'>"M"</span>, <span class='st'>"MH"</span>, <span class='st'>"HH"</span><span class='op'>)</span>,
  col_vector_flow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#FF0065"</span>, <span class='st'>"#009850"</span>, <span class='st'>"#A56F2B"</span>, <span class='st'>"#005EAA"</span>, <span class='st'>"#710500"</span>, <span class='st'>"#7B5380"</span>,
    <span class='st'>"#9DD1D1"</span><span class='op'>)</span>,
  method <span class='op'>=</span> <span class='st'>"median"</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  params_bin_numeric_pred <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>bins <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>,
  pred_train <span class='op'>=</span> <span class='cn'>NULL</span>,
  stratum_label_size <span class='op'>=</span> <span class='fl'>3.5</span>,
  force <span class='op'>=</span> <span class='cn'>F</span>,
  resp_var <span class='op'>=</span> <span class='cn'>NULL</span>,
  .f_imp <span class='op'>=</span> <span class='fu'>vip</span><span class='fu'>::</span><span class='va'><a href='https://rdrr.io/pkg/vip/man/vi_model.html'>vi_model</a></span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>m</th>
      <td><p>parsnip model or trained workflow</p></td>
    </tr>
    <tr>
      <th>data_input</th>
      <td><p>dataframe, input data</p></td>
    </tr>
    <tr>
      <th>degree</th>
      <td><p>integer,  number of top important variables to select. For
plotting more than 4 will result in two many flows and the alluvial plot
will not be very readable, Default: 4</p></td>
    </tr>
    <tr>
      <th>bins</th>
      <td><p>integer, number of bins for numeric variables, increasing this
number might result in too many flows, Default: 5</p></td>
    </tr>
    <tr>
      <th>bin_labels</th>
      <td><p>labels for the bins from low to high, Default: c("LL", "ML",
"M", "MH", "HH")</p></td>
    </tr>
    <tr>
      <th>col_vector_flow, </th>
      <td><p>character vector, defines flow colours, Default:
c('#FF0065','#009850', '#A56F2B', '#005EAA', '#710500')</p></td>
    </tr>
    <tr>
      <th>method, </th>
      <td><p>character vector, one of c('median', 'pdp')</p><dl>
<dt>median</dt><dd><p>sets variables that are not displayed to median mode, use with
regular predictions</p></dd> <dt>pdp</dt><dd><p>partial dependency plot method, for each
observation in the training data the displayed variables are set to the
indicated values. The predict function is called for each modified
observation and the result is averaged</p></dd> 
</dl><p>. Default: 'median'</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>logical, turn on parallel processing for pdp methof. Default: FALSE</p></td>
    </tr>
    <tr>
      <th>params_bin_numeric_pred</th>
      <td><p>list, additional parameters passed to
<code><a href='manip_bin_numerics.html'>manip_bin_numerics</a></code> which is applied to the pred
parameter. Default: list(bins = 5, center = T, transform = T, scale = T)</p></td>
    </tr>
    <tr>
      <th>pred_train</th>
      <td><p>numeric vector, base the automated binning of the pred vector on
the distribution of the training predictions. This is useful if marginal
histograms are added to the plot later. Default = NULL</p></td>
    </tr>
    <tr>
      <th>stratum_label_size</th>
      <td><p>numeric, Default: 3.5</p></td>
    </tr>
    <tr>
      <th>force</th>
      <td><p>logical, force plotting of over 1500 flows, Default: FALSE</p></td>
    </tr>
    <tr>
      <th>resp_var</th>
      <td><p>character, sometimes target variable cannot be inferred and
needs to be passed. Default NULL</p></td>
    </tr>
    <tr>
      <th>.f_imp</th>
      <td><p>vip function that calculates feature importance, Default: vip::vi_model</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional parameters passed to
<code><a href='alluvial_wide.html'>alluvial_wide</a></code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>ggplot2 object</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>this model visualisation approach follows the "visualising the model
 in the dataspace" principle as described in Wickham H, Cook D, Hofmann H
 (2015) Visualizing statistical models: Removing the blindfold. Statistical
 Analysis and Data Mining 8(4) &lt;doi:10.1002/sam.11271&gt;</p>
    <h2 class="hasAnchor" id="parallel-processing"><a class="anchor" href="#parallel-processing"></a>Parallel Processing</h2>

    
 
<p>We are using `furrr` and the `future` package to parallelize some of the
 computational steps for calculating the predictions. It is up to the user
 to register a compatible backend (see <a href='https://rdrr.io/pkg/future/man/plan.html'>plan</a>).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='alluvial_wide.html'>alluvial_wide</a></code>,
 <code><a href='get_data_space.html'>get_data_space</a></code>, <code><a href='https://rdrr.io/pkg/caret/man/varImp.html'>varImp</a></code>,
 <code><a href='https://rdrr.io/pkg/caret/man/predict.train.html'>extractPrediction</a></code>,
 <code><a href='get_data_space.html'>get_data_space</a></code>,
 <code><a href='get_pdp_predictions.html'>get_pdp_predictions</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>df</span> <span class='op'>=</span> <span class='va'>mtcars2</span><span class='op'>[</span>, <span class='op'>!</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>mtcars2</span><span class='op'>)</span> <span class='op'>%in%</span> <span class='st'>'ids'</span> <span class='op'>]</span>

<span class='va'>m</span> <span class='op'>=</span> <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/rand_forest.html'>rand_forest</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"randomForest"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
   <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>disp</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>df</span><span class='op'>)</span>

<span class='fu'>alluvial_model_response_parsnip</span><span class='op'>(</span><span class='va'>m</span>, <span class='va'>df</span>, degree <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='alluvial_model_response_parsnip-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># workflow --------------------------------- </span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/rand_forest.html'>rand_forest</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>"regression"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"randomForest"</span><span class='op'>)</span>

<span class='va'>rec_prep</span> <span class='op'>=</span> <span class='fu'>recipes</span><span class='fu'>::</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span><span class='va'>disp</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='va'>df</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>recipes</span><span class='fu'>::</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/prep.html'>prep</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>wf</span> <span class='op'>&lt;-</span> <span class='fu'>workflows</span><span class='fu'>::</span><span class='fu'><a href='https://workflows.tidymodels.org//reference/workflow.html'>workflow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>workflows</span><span class='fu'>::</span><span class='fu'><a href='https://workflows.tidymodels.org//reference/add_model.html'>add_model</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>workflows</span><span class='fu'>::</span><span class='fu'><a href='https://workflows.tidymodels.org//reference/add_recipe.html'>add_recipe</a></span><span class='op'>(</span><span class='va'>rec_prep</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>df</span><span class='op'>)</span>

<span class='fu'>alluvial_model_response_parsnip</span><span class='op'>(</span><span class='va'>wf</span>, <span class='va'>df</span>, degree <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>

<span class='co'># partial dependence plotting method -----</span>
<span class='fu'>future</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/future/man/plan.html'>plan</a></span><span class='op'>(</span><span class='st'>"multisession"</span><span class='op'>)</span>
<span class='fu'>alluvial_model_response_parsnip</span><span class='op'>(</span><span class='va'>m</span>, <span class='va'>df</span>, degree <span class='op'>=</span> <span class='fl'>3</span>, method <span class='op'>=</span> <span class='st'>'pdp'</span>, parallel <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


